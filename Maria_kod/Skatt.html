
<!-- SKATT-FLIKEN -->

<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <title>JSON Sandbox</title>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>  
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <link rel="stylesheet" type="text/css" href="design.css"> 
        <script src="convertcsv.js"></script>
    </head>
    <body>


      <h1>Landstingens strukturjusterade hälso- och sjukvårdskostnader per invånare. Primärvårdsansluten hemsjukvård, tandvård och omstruktureringskostnader är exkluderade</h1>
      <div id='myDiv1'><!-- Plotly chart will be drawn inside this DIV --></div>

    <br>
    <br>
    <br>
    





<script>



////////////////TESTER MED ATT VÄLJA DATATYP FÖR INDATAT. (för att den ska fungera så måste vi byta ut . mot ,)
// Denna funktion returnerar en lista  med inmatning Fråga, året vi vill visa, vilken kolumn vi vill se & vilken datatyp som datat ska få.
function testmetod(Dataset, Fråga, år, attribut, dataTyp){
    var lista = [];
    for(i=0; i<Dataset.length; i++){
      if(Dataset[i].name_long == Fråga && Dataset[i].period == år)
            lista.push(dataTyp(Dataset[i][attribut]));
        }
    return lista;
    }





var region = testmetod(Dataset,Dataset[0].name_long,"2017","geo_cat",String);
var skattLista = testmetod(Dataset,Dataset[0].name_long,"2017","value",Number)
var Y7 = testmetod(Dataset,Dataset[99].name_long,"2017","value",Number)
var Y8 = testmetod(Dataset,Dataset[11750].name_long,"2017","value",Number)
var Y9 = testmetod(Dataset,Dataset[11760].name_long,"2017","value",Number)



///Data för frågorna 1,2,4,5,16,47,48
///Detta går att skriva ner snyggare, det gör vi om vi får tid.
//notera att vissa frågor har 20xx (våren)!!!! detta måste vi hårdkoda idag, vi har uppenbarligen slarvat med tvättningen.
// fråga 16 har även inledande blanksteg, TVÄTTA!
var quest1 = testmetod(Dataset,"Landstingens strukturjusterade hälso- och sjukvårdskostnader per invånare. Primärvårdsansluten hemsjukvård, tandvård och omstruktureringskostnader är exkluderade","2017","value",Number)
var quest2 = testmetod(Dataset,"Andel i befolkningen som anser att de har tillgång till den hälso- och sjukvård de behöver","2017","value",Number)
var quest4 = testmetod(Dataset,"Andel besvarade telefonsamtal i primärvården, (enbart enheter med datoriserade telefonsystem)","2017 (våren)","value",Number)
var quest5 = testmetod(Dataset,"Andel patienter som får läkarbesök inom 7 dagar i primärvård","2017 (våren)","value",Number)
var quest16 = testmetod(Dataset,"Andel patienter som upplevt sig delaktiga och involverade i sin vård vid besök vid primärvårdsmottagningn, andelen baseras på en sammanvägning av flera enkätfrågor","2017","value",Number)
var quest47 = testmetod(Dataset,"Andel i befolkningen som har stort eller mycket stort förtroende för hälso- och sjukvården i sin helhet i sitt landsting/sin region","2017","value",Number)
var quest48 = testmetod(Dataset,"Andel i befolkningen som uppfattar att vård ges på lika villkor","2017","value",Number)





var uniqueQuestionLong = []
var uniqueQuestionShort = []

for(i=0; i<Dataset.length; i++){
        if(flags[Dataset[i].name_long]) continue;   //flags används för att rensa ut dubbletter
           flags[Dataset[i].name_long] = true;
       uniqueQuestionLong.push(Dataset[i].name_long)
}


for(i=0; i<Dataset.length; i++){
        if(flags[Dataset[i].question]) continue;   //flags används för att rensa ut dubbletter
           flags[Dataset[i].question] = true;
       uniqueQuestionShort.push(Dataset[i].question)
}



//En lista med alla våra index för de frågor som vi vill ha data på
List = [0,1,2,"FIXA RESTEN!"]



//Returnerar en lista på värden specifikt för ValuesDiagnos
// tar 3 parametrar, vilket år vi vill filtrera, vilken kolumn och ett filter som hämtar enbart värden över 20 000.
function GetValuesDiagnos(år,key){
var lista = [];
for(i=0; i < dataSetDiagnosSV.length; i++){
    if (dataSetDiagnosSV[i].period == år && dataSetDiagnosSV[i].Totalt > 20000)
      lista.push(dataSetDiagnosSV[i][key])
    }
    return lista;
}



var DiagnosTyper = GetValuesDiagnos("2013","DiagnosTyp");
var DiagValue13 = GetValuesDiagnos("2013","Totalt");
var DiagValue14 = GetValuesDiagnos("2014","Totalt");
var DiagValue15 = GetValuesDiagnos("2015","Totalt");
var DiagValue16 = GetValuesDiagnos("2016","Totalt");
var DiagValue17 = GetValuesDiagnos("2017","Totalt");





// DETTA ÄR EN KOMPLETT FUNKTION SOM RETURENAR EN LISTA PÅ UNIKA NYCKELVÄRDEN. 
//funktionen förutsätter att datasetet är en strukturerad lista med objekt i, inget Inception-tjafs får finnas i listan!
function getUniqueKeys(dataset, key){
    lista = []
    flag = []
    for(i=0; i<dataset.length; i++){
     if(flag[dataset[i][key]]) continue;   //flags används för att rensa ut dubbletter
        flag[dataset[i][key]] = true;
    lista.push(dataset[i][key])
    console.log(i)
    }
return lista
}


               //ANVÄND DENNA I TEST 1.

var data1 = [
  {
    x: region,
    y: skattLista,
    type: 'bar'
  }
];


/////////////////////////////// DETTA stycke är ramverket för Diagramet som visar sjukdomar uppdelat. KLAAAAAAAAAAAAAAAAAAAAAAAAAARRRRRRRR!!!

var data13 = {
    x: DiagnosTyper,
    y: DiagValue13,
    name:"2013",
    type: 'bar'
};


var data14 =  {
    x: DiagnosTyper,
    y: DiagValue14,
    name:"2014",
    type: 'bar'
  };


var data15 =  {
    x: DiagnosTyper,
    y: DiagValue15,
    name:"2015",
    type: 'bar'
  };


var data16 =  {
    x: DiagnosTyper,
    y: DiagValue16,
    name:"2016",
    type: 'bar'
  };


var data17 =  {
    x: DiagnosTyper,
    y: DiagValue17,
    name:"2017",
    type: 'bar'
  };


var dataSet13_17 = [data13,data14,data15,data16,data17];
var layoutGroup = {barmode: 'group'};


////////////////////////////////////////////////


var data2 = [
  {
    x: region,
    y: quest2,
    type: 'bar'
  }
];


var data3 = [
  {
    x: region,
    y: quest4,
    type: 'bar'
  }
];


var data4 = [
  {
    x: region,
    y: quest5,
    type: 'bar'
  }
];


var data5 = [
  {
    x: region,
    y: quest16,
    type: 'bar'
  }
];



var data6 = [
  {
    x:region,
    y: quest47,
    type: 'bar'
  }
];

var data7 = [
  {
    x:region,
    y: quest48,
    type: 'bar'
  }
];


var trace1 = {
  x: region,
  y: quest2,
  name: 'SF Zoo',
  type: 'bar'
};

var trace2 = {
  x: region,
  y: quest4,
  name: 'LA Zoo',
  type: 'bar'
};

var data = [trace1, trace2];

var layout = {barmode: 'stack'};

Plotly.newPlot('myDiv9', data, layout);




//var dataSum = [[data2],[data3],[data4],[data5],[data6],[data7]];



var dataSum = [[data2],[data3],[data4],[data5],[data6],[data7]];


var layoutStack = {barmode: 'stack'};

Plotly.newPlot('myDiv1', data1);
// Plotly.newPlot('myDiv2', data2);
// Plotly.newPlot('myDiv3', data3);
// Plotly.newPlot('myDiv4', data4);
// Plotly.newPlot('myDiv5', data5);
// Plotly.newPlot('myDiv6', data6);
// Plotly.newPlot('myDiv7', data7);
// Plotly.newPlot('myDiv8',  dataSet13_17, layoutGroup);
//Fixa denna
//Plotly.newPlot('myDiv9', dataSum, layoutStack);
</script>





</body>
</html>
